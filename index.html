<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Angostura Price List — Nov 9, 2025</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <style>
    :root {
      --bg:#0f1115; --card:#151822; --muted:#9aa4b2; --text:#e6eaf2; --accent:#58a6ff; --chip:#1e2330;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    header{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,rgba(15,17,21,.95),rgba(15,17,21,.75) 70%,rgba(15,17,21,0));backdrop-filter:blur(8px);}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    h1{margin:0 0 8px;font-weight:600;font-size:20px}
    .bar{display:grid;gap:8px;grid-template-columns:1fr; padding:8px 0}
    @media(min-width:900px){ .bar{grid-template-columns: 1fr 1fr 1fr 1fr auto} }
    select,input,button{width:100%;padding:10px 12px;background:var(--card);border:1px solid #293142;color:var(--text);border-radius:10px;outline:none}
    select:focus,input:focus{border-color:var(--accent)}
    button{cursor:pointer;background:#1f6feb;border-color:#1f6feb}
    button.secondary{background:var(--card);border-color:#293142}
    .card{background:var(--card);border:1px solid #222a39;border-radius:14px;padding:12px;margin-top:12px}
    .hint{color:var(--muted);font-size:12px;margin-top:6px}
    table.dataTable thead th{position:sticky;top:0;background:var(--card);}
    table.dataTable{width:100%!important;border-collapse:separate;border-spacing:0;border-radius:12px;overflow:hidden}
    .chip{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;background:var(--chip);border-radius:999px;color:#c8d1df;font-size:12px;border:1px solid #2a3242}
    footer{color:var(--muted);font-size:12px;padding:24px 0;margin-top:12px}
    a, a:visited{color:#9fd2ff}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Angostura Price List — Nov 9, 2025</h1>
      <div class="bar">
        <input id="globalSearch" type="search" placeholder="Search all columns (brand, code, UPC…)" />
        <select id="categoryFilter"><option value="">All Categories</option></select>
        <select id="subcategoryFilter"><option value="">All Subcategories</option></select>
        <div style="display:flex;gap:8px">
          <input id="minPrice" type="number" step="0.01" placeholder="Min MSRP" />
          <input id="maxPrice" type="number" step="0.01" placeholder="Max MSRP" />
        </div>
        <div style="display:flex; gap:8px;">
          <button id="resetFilters" class="secondary">Reset</button>
          <button id="downloadView">Export View (CSV)</button>
        </div>
      </div>
      <div class="hint">Tip: type “BITTERS” or “MACALLAN” or a product code to filter instantly. Use the Category chips below the title to slice by range.</div>
    </div>
  </header>

  <main class="wrap">
    <div class="card">
      <table id="priceTable" class="display"></table>
    </div>
    <footer>
      Hosted as a static site. Data loads client‑side from <code>angostura-price-list-2025-11-09.csv</code>. You can replace that file with a new CSV (same headers) anytime.
    </footer>
  </main>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    const CSV_PATH = 'angostura-price-list-2025-11-09.csv';
    let table, rawRows = [], headers = [];

    function uniqueSorted(list){ return Array.from(new Set(list.filter(Boolean))).sort((a,b)=>a.localeCompare(b)); }

    function exportViewCSV() {
      const data = table.rows({search:'applied'}).data().toArray();
      const cols = headers;
      const lines = [cols.join(',')];
      data.forEach(row => {
        // row is an array aligned with headers
        const safe = row.map(v => {
          const s = (v ?? '').toString().replace(/"/g,'""');
          return /[",\n]/.test(s) ? '"' + s + '"' : s;
        });
        lines.push(safe.join(','));
      });
      const blob = new Blob([lines.join('\n')], {type:'text/csv;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'angostura-price-list-view.csv';
      a.click();
      URL.revokeObjectURL(url);
    }

    function initFilters() {
      // Populate category + subcategory dropdowns
      const catIdx = headers.indexOf('Category');
      const subIdx = headers.indexOf('Subcategory');
      const msrpIdx = headers.indexOf('MSRP Price (Bottle)');

      const cats = uniqueSorted(rawRows.map(r => r[catIdx]));
      const subs = uniqueSorted(rawRows.map(r => r[subIdx]));
      const catSel = document.getElementById('categoryFilter');
      const subSel = document.getElementById('subcategoryFilter');
      cats.forEach(c => { const o=document.createElement('option'); o.value=c; o.textContent=c; catSel.appendChild(o); });
      subs.forEach(s => { const o=document.createElement('option'); o.value=s; o.textContent=s; subSel.appendChild(o); });

      // Global search
      document.getElementById('globalSearch').addEventListener('input', (e)=>{
        table.search(e.target.value).draw();
      });

      // Category filter
      catSel.addEventListener('change', ()=>{
        table.column(catIdx).search(catSel.value, true, false).draw();
      });
      // Subcategory filter
      subSel.addEventListener('change', ()=>{
        table.column(subIdx).search(subSel.value, true, false).draw();
      });

      // Price range filter
      const minI = document.getElementById('minPrice');
      const maxI = document.getElementById('maxPrice');
      $.fn.dataTable.ext.search.push(function(settings, data, dataIndex){
        const min = parseFloat(minI.value);
        const max = parseFloat(maxI.value);
        const val = parseFloat((data[msrpIdx] || '').toString().replace(/[^0-9.]/g,''));
        if (isNaN(val)) return true;
        if (!isNaN(min) && val < min) return false;
        if (!isNaN(max) && val > max) return false;
        return true;
      });
      minI.addEventListener('input', ()=>table.draw());
      maxI.addEventListener('input', ()=>table.draw());

      // Reset
      document.getElementById('resetFilters').addEventListener('click', ()=>{
        document.getElementById('globalSearch').value='';
        catSel.value='';
        subSel.value='';
        minI.value='';
        maxI.value='';
        table.search('');
        table.columns().search('');
        table.draw();
      });

      // Export
      document.getElementById('downloadView').addEventListener('click', exportViewCSV);
    }

    function buildTable(data) {
      headers = data[0];
      const body = data.slice(1);
      rawRows = body;

      // Render table headers
      const thead = '<thead><tr>' + headers.map(h => `<th>${h}</th>`).join('') + '</tr></thead>';
      const tbody = '<tbody>' + body.map(row => '<tr>' + row.map(cell => `<td>${cell ?? ''}</td>`).join('') + '</tr>').join('') + '</tbody>';
      document.getElementById('priceTable').innerHTML = thead + tbody;

      // Init DataTable
      table = new $.fn.dataTable.Api($('#priceTable').DataTable({
        pageLength: 25,
        order: [[ headers.indexOf('Brand Description'), 'asc' ]],
        stateSave: true,
        autoWidth: false,
        deferRender: true
      }));

      initFilters();
    }

    Papa.parse(CSV_PATH, {
      download: true,
      dynamicTyping: false,
      complete: function(results){
        if (!results || !results.data || results.data.length === 0) {
          alert('Could not load data. Check that the CSV is present in the same folder.');
          return;
        }
        buildTable(results.data);
      }
    });
  </script>
</body>
</html>
